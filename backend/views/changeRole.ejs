<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle %></title>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/homepage.css">
    <link rel="stylesheet" href="/responsive.css">
    <link rel="stylesheet" href="/subpages.css">

</head>

<body>

    <% if (role === "admin") { %>
        <%- include("includes/adminDashboard.ejs") %>
    <% } %>

    <div class="users-container">
        
        <h1 class="mb-3">Manage Users</h1>
        <p class="text-muted">Promote users to admin.</p>

        <% if (errorMessage) { %>
            <p class="alert alert-danger"><%= errorMessage %></p>
        <% } %>

        <% if (!users || users.length === 0) { %>

            <h4>No users found.</h4>

        <% } else { %>

            <table class="table table-bordered table-striped shadow-sm" style="border-radius:8px; overflow:hidden;">
                <thead class="bg-dark text-white">
                    <tr>
                        <th>User ID</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Change Role</th>
                    </tr>
                </thead>

                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td><%= user.ID %></td>
                            <td><%= user.email %></td>
                            <td><%= user.role %></td>

                            <td>
                                <% if (user.role === "admin") { %>

                                    <span class="locked-badge">Admin (Locked)</span>

                                <% } else { %>

                                    <form action="/admin/change-role" method="POST"
                                          onsubmit="return confirm('Are you sure you want to make this user an admin?');">

                                        <input type="hidden" name="userId" value="<%= user.ID %>">
                                        <input type="hidden" name="role" value="admin">

                                        <button type="submit" class="btn-united">
                                            Make Admin
                                        </button>
                                    </form>

                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>

        <% } %>

    </div>

    <%- include('includes/footer.ejs') %>

</body>
</html>
